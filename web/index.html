<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>vasbazaar</title>
    
    <!-- Safari-optimized viewport meta tag -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, shrink-to-fit=no" />
    
    <!-- Orientation support -->
    <meta name="orientation" content="portrait|landscape" />
    
    <!-- iOS specific meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- Theme color -->
    <meta name="theme-color" content="#000000" />
    
    <!-- Cross-browser compatibility -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    
    <style>
        /* Reset and global styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: none;
        }
        
        /* Prevent bounce on iOS */
        body {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            background-color: #ffffff;
        }
        
        #root {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Safe area handling for notched devices - integrate with React Native */
        :root {
            --safe-area-inset-top: env(safe-area-inset-top, 0px);
            --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
            --safe-area-inset-left: env(safe-area-inset-left, 0px);
            --safe-area-inset-right: env(safe-area-inset-right, 0px);
        }
        
        /* Let React Native handle safe areas instead of CSS padding */
        @supports (padding: max(0px)) {
            #root {
                /* Remove direct padding - React Native SafeAreaView will handle this */
                padding: 0;
                /* But ensure the viewport uses full available space */
                height: calc(100vh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom));
                width: calc(100vw - var(--safe-area-inset-left) - var(--safe-area-inset-right));
                margin-top: var(--safe-area-inset-top);
                margin-left: var(--safe-area-inset-left);
            }
        }
        
        /* Prevent text selection on UI elements */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Fix for 100vh on mobile browsers, especially Safari */
        .full-height {
            height: 100vh;
            height: -webkit-fill-available;
        }
        
        /* Safari-specific fixes for viewport and header images */
        @supports (-webkit-touch-callout: none) {
            /* Safari on iOS */
            html, body {
                height: -webkit-fill-available;
                min-height: -webkit-fill-available;
            }
            
            #root {
                min-height: -webkit-fill-available;
                height: -webkit-fill-available;
            }
        }
        
        /* Prevent Safari zoom on input focus */
        @media screen and (-webkit-min-device-pixel-ratio: 0) {
            select,
            textarea,
            input[type="text"],
            input[type="password"],
            input[type="datetime"],
            input[type="datetime-local"],
            input[type="date"],
            input[type="month"],
            input[type="time"],
            input[type="week"],
            input[type="number"],
            input[type="email"],
            input[type="url"],
            input[type="search"],
            input[type="tel"] {
                font-size: 16px !important;
            }
        }
        
        /* Loading screen styles */
        .loading-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #ffffff;
        }
        
        /* Prevent scrollbar appearance */
        ::-webkit-scrollbar {
            display: none;
        }
        
        * {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Mobile browser bottom navigation fixes */
        @media screen and (max-width: 768px) {
            /* Ensure bottom navigation is always visible on mobile browsers */
            [data-testid*="tab"] {
                position: fixed !important;
                bottom: 0 !important;
                left: 0 !important;
                right: 0 !important;
                z-index: 9999 !important;
                width: 100% !important;
                display: flex !important;
            }
            
            /* Fix for mobile browser address bar hiding */
            html {
                height: 100vh;
                height: -webkit-fill-available;
            }
            
            body {
                height: 100vh;
                height: -webkit-fill-available;
                padding-bottom: env(safe-area-inset-bottom);
            }
            
            /* iPhone Safari specific fixes for content spacing */
            @supports (-webkit-touch-callout: none) {
                /* Target iPhone Safari specifically */
                body {
                    padding-bottom: calc(env(safe-area-inset-bottom) + 50px) !important;
                }
                
                /* Add extra spacing for all scrollable content on iPhone */
                [data-react-native="true"] {
                    padding-bottom: 100px !important;
                }
                
                /* Force extra spacing for last elements - more aggressive */
                *:last-child {
                    margin-bottom: 80px !important;
                    padding-bottom: 60px !important;
                }
                
                /* Specifically target scroll containers */
                div[style*="overflow"] {
                    padding-bottom: 120px !important;
                }
            }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading-container">
            <div>Loading vasbazaar...</div>
        </div>
    </div>
    
    <!-- Service Worker Registration and PWA Setup -->
    <script>
        // Debug function to check manifest and PWA setup
        window.debugPWASetup = async () => {
            console.log('🔍 [PWA Debug] Checking PWA setup...');
            
            // Check manifest
            try {
                const manifestResponse = await fetch('/manifest.json');
                const manifest = await manifestResponse.json();
                console.log('📋 [PWA Debug] Manifest loaded:', manifest);
                
                // Check icons
                for (const icon of manifest.icons) {
                    try {
                        const iconResponse = await fetch(icon.src);
                        console.log(`📱 [PWA Debug] Icon ${icon.src}:`, iconResponse.ok ? 'OK' : 'FAILED');
                    } catch (e) {
                        console.log(`❌ [PWA Debug] Icon ${icon.src} failed:`, e.message);
                    }
                }
            } catch (error) {
                console.log('❌ [PWA Debug] Manifest failed:', error);
            }
            
            // Check service worker
            if ('serviceWorker' in navigator) {
                const registration = await navigator.serviceWorker.getRegistration();
                console.log('🔧 [PWA Debug] Service Worker:', registration ? 'Registered' : 'Not registered');
            }
            
            // Check install prompt availability
            console.log('📲 [PWA Debug] Install prompt available:', window.globalInstallPrompt ? 'YES' : 'NO');
            
            // Check if running as PWA
            const isPWA = window.matchMedia('(display-mode: standalone)').matches ||
                         window.navigator.standalone ||
                         document.referrer.includes('android-app://');
            console.log('📱 [PWA Debug] Running as PWA:', isPWA);
        };
        
        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('✅ [PWA] Service Worker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('❌ [PWA] Service Worker registration failed:', error);
                    });
            });
        }
        
        // Auto-check PWA setup in development
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            setTimeout(() => {
                console.log('🧪 [PWA Debug] Auto-checking PWA setup (dev mode)');
                window.debugPWASetup();
            }, 2000);
        }
    </script>
    
    <!-- Safari-optimized viewport and scroll handling -->
    <script>
        // Safari-specific viewport height fix
        function setVH() {
            let vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
            
            // Safari-specific fix for address bar
            if (/Safari/.test(navigator.userAgent) && /iPhone|iPad|iPod/.test(navigator.userAgent)) {
                // Wait for Safari to settle after address bar changes
                setTimeout(() => {
                    vh = window.innerHeight * 0.01;
                    document.documentElement.style.setProperty('--vh', `${vh}px`);
                }, 500);
            }
        }
        
        // Initial setup
        setVH();
        
        // Listen to resize and orientationchange events
        window.addEventListener('resize', setVH);
        window.addEventListener('orientationchange', () => {
            // Safari needs extra time after orientation change
            setTimeout(setVH, 500);
        });
        
        // Prevent pull-to-refresh on mobile
        document.addEventListener('touchmove', function(event) {
            if (event.scale !== 1) {
                event.preventDefault();
            }
        }, { passive: false });
        
        // Prevent overscroll and bounce
        document.body.addEventListener('touchmove', function(event) {
            if (document.body.scrollTop === 0 && event.touches[0].pageY > 0) {
                event.preventDefault();
            }
        }, { passive: false });
        
        // Safari-specific scroll fixes
        if (/Safari/.test(navigator.userAgent) && /iPhone|iPad|iPod/.test(navigator.userAgent)) {
            // Fix Safari's bouncing scroll
            document.documentElement.style.overflow = 'hidden';
            document.body.style.overflow = 'hidden';
            document.body.style.position = 'fixed';
            document.body.style.width = '100%';
        }
    </script>
    
    <!-- Expo bundle will be injected here -->
</body>
</html>